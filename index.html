<html>
<body>
<pre id='token'></pre>
<pre id='receipt'></pre>
<script src="https://unpkg.com/rareterm@0.0.9"></script>
<script>
const queryString = window.location.search;
const urlParams = new URLSearchParams(queryString);
let title = urlParams.get('title')
let desc = urlParams.get('desc')


const mint = async () => {

  // 1. Initialize a rarepress object from Rareterm
  const rarepress = new Rareterm();
  // 2. Connect to a rinkeby rarenet node
  await rarepress.init({ host: "https://eth.rarenet.app/v1" })

  // 3. Import a web image to rarepress file system
  let cid = await rarepress.fs.add("https://i.imgur.com/7VtdUHN.jpeg")

  // 4. Create and save a token on rarepress
  let token = await rarepress.token.create({
    type: "ERC721",
    metadata: {
      name: title,
      description: desc,
      image: "/ipfs/" + cid
    }
  })

  // 5. Publish the image on public IPFS
  await rarepress.fs.push(cid)
  // 6. Publish the metadata on public IPFS
  await rarepress.fs.push(token.tokenURI)

  // 7. Publish the token to the marketplace
  let receipt = await rarepress.token.send(token)

  document.querySelector("#token").innerHTML = "token object\n\n" + JSON.stringify(token, null, 2)
  document.querySelector("#receipt").innerHTML = "token publish receipt\n\n" + JSON.stringify(receipt, null, 2)
}
mint()
</script>
</body>
</html>
